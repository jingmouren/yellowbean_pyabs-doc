from absbox import SPV

FY_AUTO_2023_2 = SPV(
    "福元2023年第二期个人汽车抵押贷款证券化信托"
    ,{"封包日":"2023-05-01","起息日":"2023-07-18","首次兑付日":"2023-08-28"
     ,"法定到期日":"2029-02-26","收款频率":"月末","付款频率":["每月",26]} 
    ,{'发行':{'资产池规模':2_149_999_182.95}
      ,'清单':[]
      ,'归集表':[['2023-05-31', 2065368814.41, 84630368.54, 4324336.74],
                 ['2023-06-30', 1980629402.87, 84739411.54, 4215293.73],
                 ['2023-07-31', 1895780449.66, 84848953.21, 4105752.06],
                 ['2023-08-31', 1810821453.56, 84958996.1, 3995709.18],
                 ['2023-09-30', 1725751910.83, 85069542.73, 3885162.54],
                 ['2023-10-31', 1640571315.14, 85180595.69, 3774109.58],
                 ['2023-11-30', 1555279157.6, 85292157.54, 3662547.73],
                 ['2023-12-31', 1469874926.72, 85404230.88, 3550474.39],
                 ['2024-01-31', 1385742975.23, 84131951.49, 3437886.95],
                 ['2024-02-29', 1302429538.34, 83313436.89, 3324782.8],
                 ['2024-03-31', 1219798680.51, 82630857.82, 3211216.22],
                 ['2024-04-30', 1137231717.33, 82566963.18, 3097828.98],
                 ['2024-05-31', 1054711926.12, 82519791.22, 2984034.02],
                 ['2024-06-30', 972457038.47, 82254887.65, 2869807.41],
                 ['2024-07-31', 892882852.74, 79574185.73, 2755295.09],
                 ['2024-08-31', 815607714.43, 77275138.32, 2641208.31],
                 ['2024-09-30', 740714704.47, 74893009.96, 2527238.14],
                 ['2024-10-31', 668528987.06, 72185717.4, 2413776.39],
                 ['2024-11-30', 599547653.23, 68981333.83, 2300702.75],
                 ['2024-12-31', 540768370.45, 58779282.78, 2187883.88],
                 ['2025-01-31', 493642798.08, 47125572.37, 2077249.84],
                 ['2025-02-28', 454567003.18, 39075794.9, 1968907.43],
                 ['2025-03-31', 422038520.61, 32528482.57, 1862104.91],
                 ['2025-04-30', 389560282.92, 32478237.69, 1756949.3],
                 ['2025-05-31', 357127826.65, 32432456.27, 1651749.32],
                 ['2025-06-30', 324702243.81, 32425582.84, 1546535.26],
                 ['2025-07-31', 293599007.84, 31103235.97, 1441126.97],
                 ['2025-08-31', 263936135.13, 29662872.72, 1339325.46],
                 ['2025-09-30', 235560852.45, 28375282.67, 1241049.35],
                 ['2025-10-31', 208670704.28, 26890148.17, 1146193.02],
                 ['2025-11-30', 183374711.59, 25295992.7, 1055511.09],
                 ['2025-12-31', 162817451.75, 20557259.84, 968748.1],
                 ['2026-01-31', 147741089.31, 15076362.44, 893473.72],
                 ['2026-02-28', 137375951.81, 10365137.5, 831780.8],
                 ['2026-03-31', 129878243.98, 7497707.83, 782299.77],
                 ['2026-04-30', 122338588.33, 7539655.65, 740351.95],
                 ['2026-05-31', 114758659.3, 7579929.03, 698163.24],
                 ['2026-06-30', 107154748.66, 7603910.64, 655743.38],
                 ['2026-07-31', 99598873.79, 7555874.87, 613167.26],
                 ['2026-08-31', 92084946.2, 7513927.59, 570750.67],
                 ['2026-09-30', 84642894.64, 7442051.57, 528497.58],
                 ['2026-10-31', 77255006.33, 7387888.3, 486547.2],
                 ['2026-11-30', 69929321.19, 7325685.15, 444832.63],
                 ['2026-12-31', 62925924.72, 7003396.47, 403428.54],
                 ['2027-01-31', 56472105.71, 6453819.01, 363603.53],
                 ['2027-02-28', 50428034.16, 6044071.56, 326709.36],
                 ['2027-03-31', 44591801.47, 5836232.69, 291916.62],
                 ['2027-04-30', 38734392.27, 5857409.2, 258134.44],
                 ['2027-05-31', 32854757.4, 5879634.87, 224235.86],
                 ['2027-06-30', 27097902.86, 5756854.54, 190206.69],
                 ['2027-07-31', 21609876.08, 5488026.78, 156863.24],
                 ['2027-08-31', 16386521.57, 5223354.5, 125083.8],
                 ['2027-09-30', 11385115.64, 5001405.93, 94851.87],
                 ['2027-10-31', 6709010.62, 4676105.02, 65901.77],
                 ['2027-11-30', 3100324.54, 3608686.08, 38839.43],
                 ['2027-12-31', 884710.55, 2215613.99, 17914.15],
                 ['2028-01-31', 0.0, 884710.55, 5093.32]]
     }
    ,(("信托收付账户",{"余额":0 ,"计息":{"周期":["平移","季度末",-10]
                                     ,"利率":0.01
                                     ,"最近结息日":"2023-07-18"}})
      ,("优先支付账户",{"余额":0 })
      ,("流动性储备",{"余额":21_499_991.83
                    ,"类型":{"目标储备金额":["资产池余额",0.01]}
                    ,"计息":{"周期":["平移","季度末",-10] 
                            ,"利率":0.01
                            ,"最近结息日":"2023-07-18"}}))
    ,(("优先A1",{"当前余额":720_000_000.00
             ,"当前利率":0.0225
             ,"初始余额":720_000_000.00
             ,"初始利率":0.0225
             ,"起息日":"2023-07-18"
             ,"利率":{"固定":0.0225,"日历":"DC_30_360_US"}
             ,"债券类型":{"固定摊还":[['2023-08-26', 654624000.0],
                                    ['2023-09-26', 589248000.0],
                                    ['2023-10-26', 523872000.0],
                                    ['2023-11-26', 458496000.0],
                                    ['2023-12-26', 393120000.0],
                                    ['2024-01-26', 327600000.0],
                                    ['2024-02-26', 262080000.0],
                                    ['2024-03-26', 196560000.0],
                                    ['2024-04-26', 131040000.0],
                                    ['2024-05-26', 65520000.0],
                                    ['2024-06-26', 0.0]]}})
      ,("优先A2",{"当前余额":1_190_000_000.00
             ,"当前利率":0.0235
             ,"初始余额":1_190_000_000.00
             ,"初始利率":0.0235
             ,"起息日":"2023-07-18"
             ,"利率":{"固定":0.0235,"日历":"DC_30_360_US"}
             ,"债券类型":{"过手摊还":None}
             })
      ,("次级",{"当前余额":118_000_000.00
             ,"当前利率":0.0
             ,"初始余额":118_000_000.00
             ,"初始利率":0.0
             ,"起息日":"2023-07-18"
             ,"利率":{"固定":0.00}
             ,"债券类型":{"权益":None}
             })
     )
    ,(("增值税",{"类型":{"差额费用":[("factor"
                                   ,("资产池累计","利息"),0.0326)
                                   ,("费用支付总额",None,"增值税")]}})
      ,("服务商费用",{"类型":{"年化费率":["资产池余额",0.0005]}})
      ,("兑付手续费",{"类型":{"差额费用":[("factor"
                                       ,("债券支付总额",None,"优先A1","优先A2","次级"),0.00005)
                                       ,("费用支付总额",None,"兑付手续费")]}})
      ,("评级跟踪费用",{"类型":{"周期费用":[["每年",6,30],100000]}})
      ,("报销",{"类型":{"自定义":[]}})
     )
    ,{"未违约":[
         ["账户转移","流动性储备","信托收付账户"]
         ,["支付费用","信托收付账户",["增值税"]] 
         ,["支付费用","信托收付账户",["服务商费用"]]
         ,["支付费用","信托收付账户",["评级跟踪费用"]] 
         ,["计提支付费用","信托收付账户",["兑付手续费"]]
         ,["计提费用","报销"]
         ,["支付费用","信托收付账户",["报销"],{"应计费用上限":150000}]         
#
         ,["计提支付利息","信托收付账户",["优先A1","优先A2"]]
         ,["账户转移","信托收付账户","优先支付账户"
           ,{"公式":("floorWithZero"
                   ,("差额",("债券余额","优先A1","优先A2"),("资产池余额",)))}]
        #
         ,["支付本金","优先支付账户",["优先A1"]]
         ,["支付本金","优先支付账户",["优先A2"]]
         ,["支付剩余本金","优先支付账户",["优先A1"]]
         ,["账户转移","信托收付账户","流动性储备",{"储备":"缺口"}]
        #
         ,["支付本金","信托收付账户",["优先A1"]]
         ,["支付本金","信托收付账户",["优先A2"]]
         ,["支付剩余本金","信托收付账户",["优先A1"]]
         ,["支付费用","信托收付账户",["报销"]]
         ,["支付本金","信托收付账户",["次级"]]
         ,["支付收益","信托收付账户","次级"]
      ]
     ,"回款后":[["计提费用","服务商费用","增值税"]]
     ,"清仓回购":[
                 ["出售资产",["正常|违约",1.0,0.0],"信托收付账户"]
                 ,["账户转移","流动性储备","信托收付账户"]
                 ,["支付费用","信托收付账户",["服务商费用","兑付手续费","增值税"]]
                 ,["计提支付利息","信托收付账户",["优先A1","优先A2"]]
                 ,["支付本金","信托收付账户",["优先A1","优先A2"]]
                 ,["支付本金","信托收付账户",["次级"]]
                 ,["支付收益","信托收付账户","次级"]
                 ]}
    ,(["利息回款","信托收付账户"]
      ,["本金回款","信托收付账户"]
      ,["早偿回款","信托收付账户"]
      ,["回收回款","信托收付账户"])
    ,None
    ,None
    ,None
)

#r = localAPI.run(FY_AUTO_2023_2,    # 这里 jy 就表示一个ABS产品模型
#             assumptions=[{"预计费用":["报销",[["2023-08-20",45000]
#                                             ,["2023-09-20",155000]]]}],
#             read=True)